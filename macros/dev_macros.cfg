

;[gcode_macro MMU_GEAR_STEPPER_TEST_MOVE]
;description: HH MMU Workaround for calibrating Gear Stepper Rotational Distance until github servo issue is fixed (841)

;gcode:
;  {% set move  = params.MOVE|default(100)|int %}
;  {% set speed = [params.SPEED|default(30)|int,50]|min %}

;  {% if printer.mmu.enabled %}
;     {% if using_bypass %}
;        M118 Cant calibrate Gear selector using the bypass gate
;     {% else %}
;        M118 Make sure you have the gate selected and filament loaded and aligned with the encoder exit or somewhere you can measure the distance from
;        M118 Activating the gear servo and moving filament {move}mm
;        MMU_SERVO POS=DOWN
;        FORCE_MOVE STEPPER=stepper_mmu_gear DISTANCE={move} VELOCITY={speed}
;        M118 Measure the distance and update the rotational distance using MMU_CALIBRATE_GEAR LENGTH={move} MEASURED=distance_moved_mm
;      {% endif %}
;  {% endif %}

###########################################################################
# Macro to query filament pressure sensor (proportional sync feedback) state
#
[gcode_macro MMU_QUERY_FPS2]
description: "Show raw and scaled filament pressure sensor (proportional sync feedback) readings"
variable_sensor: "filament_proportional"
gcode:
    {% set name = params.SENSOR|default(sensor) %}
    {% set obj  = printer[name] %}
    ;M118 FPS Raw: { obj.fps_value|float|round(3) } Offset: { obj.fps_value_offset|float|round(3) } Scaled: { obj.fps_value_scaled|float|round(3) } Set point: { obj.set_point|float|round(3) }  Range multiplier: { obj.range_multiplier|float|round(2) }
    M118 FPS Enabled: {obj.enabled} Value: {obj.value|float|round(3)} Raw Value: {obj.value_raw|float|round(3)}

;// printer['gcode_macro _MMU_PARK'].park_operation =
;// printer['mmu'].sync_feedback_state = inactive
;// printer['mmu'].sync_feedback_enabled = 1
;// printer['mmu'].sync_feedback_bias_raw = 0.008142716166199666
;// printer['mmu'].sync_feedback_bias_modelled = 0.008142716166199666

;sync_feedback_analog_set_point: 0.489           # Neutral point (0..1), maps that raw value to 0.0
;sync_feedback_analog_scale: 2.2       
;sync_feedback_analog_scale
;sync_feedback_analog_set_point
;sync_feedback_bias_modelled
;sync_feedback_bias_raw
;sync_feedback_enabled
;sync_feedback_state